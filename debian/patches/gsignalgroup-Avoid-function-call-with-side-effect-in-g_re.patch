From: Kleis Auke Wolthuizen <github@kleisauke.nl>
Date: Wed, 1 Nov 2023 10:53:55 +0000
Subject: gsignalgroup: Avoid function call with side effect in g_return_*
 macro

Origin: upstream, 2.78.2, commit:a5ea4d4c748cdf6c804c52b8459c1eff95720866
---
 gobject/gsignalgroup.c      | 9 +++++++--
 gobject/tests/signalgroup.c | 2 +-
 2 files changed, 8 insertions(+), 3 deletions(-)

diff --git a/gobject/gsignalgroup.c b/gobject/gsignalgroup.c
index e773fc0..6cf9cc9 100644
--- a/gobject/gsignalgroup.c
+++ b/gobject/gsignalgroup.c
@@ -718,10 +718,15 @@ g_signal_group_connect_closure_ (GSignalGroup   *self,
 
   g_return_val_if_fail (G_IS_SIGNAL_GROUP (self), FALSE);
   g_return_val_if_fail (detailed_signal != NULL, FALSE);
-  g_return_val_if_fail (g_signal_parse_name (detailed_signal, self->target_type,
-                                             &signal_id, &signal_detail, TRUE) != 0, FALSE);
   g_return_val_if_fail (closure != NULL, FALSE);
 
+  if (!g_signal_parse_name (detailed_signal, self->target_type,
+                            &signal_id, &signal_detail, TRUE))
+    {
+      g_critical ("Invalid signal name “%s”", detailed_signal);
+      return FALSE;
+    }
+
   g_rec_mutex_lock (&self->mutex);
 
   if (self->has_bound_at_least_once)
diff --git a/gobject/tests/signalgroup.c b/gobject/tests/signalgroup.c
index 436d7ea..198c16c 100644
--- a/gobject/tests/signalgroup.c
+++ b/gobject/tests/signalgroup.c
@@ -305,7 +305,7 @@ test_signal_group_invalid (void)
 
   /* Invalid Signal Name */
   g_test_expect_message (G_LOG_DOMAIN, G_LOG_LEVEL_CRITICAL,
-                         "*g_signal_parse_name*");
+                         "*Invalid signal name “does-not-exist”*");
   group = g_signal_group_new (signal_target_get_type ());
   g_signal_group_connect (group,
                           "does-not-exist",
