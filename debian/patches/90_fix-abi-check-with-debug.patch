From SVN r5683 and r5687; fix build

2007-08-08  Matthias Clasen  <mclasen@redhat.com>

	* glib/glib.symbols:
	* glib/Makefile.am:
	* glib/abicheck.sh: Make it work regardless of --enable-debug

--- glib/Makefile.am.orig	2007-08-03 19:52:48.000000000 +0200
+++ glib/Makefile.am	2007-08-20 21:55:37.000000000 +0200
@@ -36,6 +36,7 @@
 
 if OS_LINUX
 if HAVE_GNUC_VISIBILITY
+TESTS_ENVIRONMENT = GLIB_DEBUG_FLAGS="$(GLIB_DEBUG_FLAGS)"
 TESTS = abicheck.sh pltcheck.sh
 endif
 endif
--- glib/Makefile.in.orig	2007-08-20 21:55:45.000000000 +0200
+++ glib/Makefile.in	2007-08-20 21:55:59.000000000 +0200
@@ -265,6 +265,7 @@
 	$(GLIB_DEBUG_FLAGS) -DG_DISABLE_DEPRECATED -DGLIB_COMPILATION 
 
 
+@HAVE_GNUC_VISIBILITY_TRUE@@OS_LINUX_TRUE@TESTS_ENVIRONMENT = GLIB_DEBUG_FLAGS="$(GLIB_DEBUG_FLAGS)"
 @HAVE_GNUC_VISIBILITY_TRUE@@OS_LINUX_TRUE@TESTS = abicheck.sh pltcheck.sh
 
 BUILT_SOURCES = galias.h galiasdef.c
--- glib/abicheck.sh.orig	2007-08-03 19:52:48.000000000 +0200
+++ glib/abicheck.sh	2007-08-20 21:55:37.000000000 +0200
@@ -3,7 +3,7 @@
 egrep '^#([^i]|if).*[^\]$' "${top_builddir:-..}/glibconfig.h" > glibconfig.cpp
 
 INCLUDES="-include ${top_builddir:-..}/config.h"
-INCLUDES="$INCLUDES -include glibconfig.cpp"
+INCLUDES="$INCLUDES -include glibconfig.cpp $GLIB_DEBUG_FLAGS"
 
 cpp -P -DINCLUDE_INTERNAL_SYMBOLS -DINCLUDE_VARIABLES -DG_STDIO_NO_WRAP_ON_UNIX -DALL_FILES $INCLUDES "${srcdir:-.}/glib.symbols" | sed -e '/^$/d' -e 's/ G_GNUC.*$//' -e 's/ PRIVATE$//' | sort > expected-abi
 rm -f glibconfig.cpp
--- glib/glib.symbols.orig	2007-08-03 19:52:48.000000000 +0200
+++ glib/glib.symbols	2007-08-20 21:55:37.000000000 +0200
@@ -691,11 +691,13 @@
 g_slice_set_config
 g_slice_get_config
 g_slice_get_config_state
+#ifdef G_ENABLE_DEBUG
 #ifdef INCLUDE_INTERNAL_SYMBOLS
 g_slice_debug_tree_statistics
 #endif
 #endif
 #endif
+#endif
 
 #if IN_HEADER(__G_MESSAGES_H__)
 #if IN_FILE(__G_MESSAGES_C__)
