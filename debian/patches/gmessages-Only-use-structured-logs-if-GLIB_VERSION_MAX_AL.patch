From: Philip Withnall <withnall@endlessm.com>
Date: Fri, 26 Jul 2019 20:49:01 +0100
Subject: =?utf-8?q?gmessages=3A_Only_use_structured_logs_if_GLIB=5FVERSION?=
 =?utf-8?q?=5FMAX=5FALLOWED_is_=E2=89=A52=2E56?=
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: 8bit

Only redefine g_message() and friends to use structured logging if the
compiling code is OK with depending on GLib functionality from â‰¥2.56.

Signed-off-by: Philip Withnall <withnall@endlessm.com>

Bug: #1847
Origin: upstream, 2.60.7, commit:0519199cce24e85ba605a82e81e71ea598feba0b
---
 glib/gmessages.h | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/glib/gmessages.h b/glib/gmessages.h
index c609d08..95d60c5 100644
--- a/glib/gmessages.h
+++ b/glib/gmessages.h
@@ -296,7 +296,7 @@ void g_log_structured_standard (const gchar    *log_domain,
 #endif  /* G_LOG_DOMAIN */
 
 #if defined(G_HAVE_ISO_VARARGS) && !G_ANALYZER_ANALYZING
-#ifdef G_LOG_USE_STRUCTURED
+#if defined(G_LOG_USE_STRUCTURED) && GLIB_VERSION_MAX_ALLOWED >= GLIB_VERSION_2_56
 #define g_error(...)  G_STMT_START {                                            \
                         g_log_structured_standard (G_LOG_DOMAIN, G_LOG_LEVEL_ERROR, \
                                                    __FILE__, G_STRINGIFY (__LINE__), \
@@ -345,7 +345,7 @@ void g_log_structured_standard (const gchar    *log_domain,
                                __VA_ARGS__)
 #endif
 #elif defined(G_HAVE_GNUC_VARARGS)  && !G_ANALYZER_ANALYZING
-#ifdef G_LOG_USE_STRUCTURED
+#if defined(G_LOG_USE_STRUCTURED) && GLIB_VERSION_MAX_ALLOWED >= GLIB_VERSION_2_56
 #define g_error(format...)   G_STMT_START {                                          \
                                g_log_structured_standard (G_LOG_DOMAIN, G_LOG_LEVEL_ERROR, \
                                                           __FILE__, G_STRINGIFY (__LINE__), \
