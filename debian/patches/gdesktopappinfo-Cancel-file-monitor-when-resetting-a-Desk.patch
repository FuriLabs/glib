From: Philip Withnall <withnall@endlessm.com>
Date: Fri, 11 Oct 2019 22:19:29 +0100
Subject: gdesktopappinfo: Cancel file monitor when resetting a DesktopFileDir
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: 8bit

Itâ€™s not enough to unref the monitor, since the GLib worker thread might
still hold a reference to it.

Signed-off-by: Philip Withnall <withnall@endlessm.com>

Bug: https://gitlab.gnome.org/GNOME/glib/issues/1903
Bug-Debian: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=941550
Origin: upstream, 2.62.3, commit:fd15e33bc89ceb3f4545e12d6c0fb1a1ed7e7d5e
---
 gio/gdesktopappinfo.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/gio/gdesktopappinfo.c b/gio/gdesktopappinfo.c
index 7e2c353..f1e2fdd 100644
--- a/gio/gdesktopappinfo.c
+++ b/gio/gdesktopappinfo.c
@@ -1329,6 +1329,7 @@ desktop_file_dir_reset (DesktopFileDir *dir)
   if (dir->monitor)
     {
       g_signal_handlers_disconnect_by_func (dir->monitor, desktop_file_dir_changed, dir);
+      g_file_monitor_cancel (dir->monitor);
       g_object_unref (dir->monitor);
       dir->monitor = NULL;
     }
